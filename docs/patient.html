<!DOCTYPE html>
<html lang ="en">

<head>
    <meta charset ="UTF-8">
    <meta http-equiv="X-US-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRaINlab Grip Symmetry Measurement</title>

    <!--StyleSheet and Icon Reference-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css">
    <link rel="stylesheet" href="./aggieimpact_design/css/patientStyle.css">
    <link rel="stylesheet" href="./aggieimpact_design/css/dataStyle.css">

    <!--JQuery Import-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!--Firebase Libraries-->
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 
    <script type="module" src="firebase.js"></script>
    <script id="FireBaseScript"></script>

    <!--Data Collection Functions-->
    <script src="https://unpkg.com/@vernier/godirect/dist/godirect.min.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="data.js"></script>
    
    <!--patient search functions-->
    <script>
        function filterTable(){
            var input, filter, table, tr, td ,i, txtValue;
            input = document.getElementById('searchingFor');
            filter = input.value.toUpperCase();
            table = document.getElementById('patientTable');
            tr = table.getElementsByTagName('tr');
            for (i=0;i<tr.length;i++)
            {
                td = tr[i].getElementsByTagName('td')[0];
                if (td)
                {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1){
                        tr[i].style.display="";
                    }
                    else{
                        tr[i].style.display="none";
                    }
                }
            }
        }
    </script>
</head>

<body onload="Initialize(); check_BLE_support();">
    <div id="mainBody" style="display:none;">
    
    <section id="menu">
        <div class="logo">
            <img src="aggieimpact_design/images/BRAIN_Lab_Icon.png" alt="">
        </div>
        <div class="MenuItems">
            <li id="signOut">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#FFFFFF" d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/></svg>
                <a href="#">Sign Out</a>
            </li>
            <li id="PatientNav">
                <svg fill="#ffffff" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 45.532 45.532" xml:space="preserve" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M22.766,0.001C10.194,0.001,0,10.193,0,22.766s10.193,22.765,22.766,22.765c12.574,0,22.766-10.192,22.766-22.765 S35.34,0.001,22.766,0.001z M22.766,6.808c4.16,0,7.531,3.372,7.531,7.53c0,4.159-3.371,7.53-7.531,7.53 c-4.158,0-7.529-3.371-7.529-7.53C15.237,10.18,18.608,6.808,22.766,6.808z M22.761,39.579c-4.149,0-7.949-1.511-10.88-4.012 c-0.714-0.609-1.126-1.502-1.126-2.439c0-4.217,3.413-7.592,7.631-7.592h8.762c4.219,0,7.619,3.375,7.619,7.592 c0,0.938-0.41,1.829-1.125,2.438C30.712,38.068,26.911,39.579,22.761,39.579z"></path> </g> </g></svg>
                <a href="#interface">Patients</a>
            </li>  
            <li id="exportNav" style="display:none;">
                <svg width="256px" height="256px" viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="0.648"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.192"></g><g id="SVGRepo_iconCarrier"> <path d="M12.44 14.75H3.75C3.34 14.75 3 14.41 3 14C3 13.59 3.34 13.25 3.75 13.25H12.44L10.72 11.53C10.43 11.24 10.43 10.76 10.72 10.47C11.01 10.18 11.49 10.18 11.78 10.47L14.78 13.47C14.85 13.54 14.9 13.62 14.94 13.71C15.02 13.89 15.02 14.1 14.94 14.28C14.9 14.37 14.85 14.45 14.78 14.52L11.78 17.52C11.63 17.67 11.44 17.74 11.25 17.74C11.06 17.74 10.87 17.67 10.72 17.52C10.43 17.23 10.43 16.75 10.72 16.46L12.44 14.74V14.75ZM21 9.5V18C21 19.52 19.77 20.75 18.25 20.75H10.75C9.23 20.75 8 19.52 8 18V17C8 16.59 8.34 16.25 8.75 16.25C9.16 16.25 9.5 16.59 9.5 17V18C9.5 18.69 10.06 19.25 10.75 19.25H18.25C18.94 19.25 19.5 18.69 19.5 18V10.25H14.75C14.34 10.25 14 9.91 14 9.5V4.75H10.75C10.06 4.75 9.5 5.31 9.5 6V11C9.5 11.41 9.16 11.75 8.75 11.75C8.34 11.75 8 11.41 8 11V6C8 4.48 9.23 3.25 10.75 3.25H14.75C14.95 3.25 15.14 3.33 15.28 3.47L20.78 8.97C20.92 9.11 21 9.3 21 9.5ZM15.5 8.75H18.44L15.5 5.81V8.75Z" fill="#ffffff"></path> </g></svg>
                <a href="#adminExport">Export Data</a>
            </li>     
            <li id="adminNav" style="display:none;">
                <svg fill="#ffffff" height="200px" width="200px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 474.565 474.565" xml:space="preserve" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M255.204,102.3c-0.606-11.321-12.176-9.395-23.465-9.395C240.078,95.126,247.967,98.216,255.204,102.3z"></path> <path d="M134.524,73.928c-43.825,0-63.997,55.471-28.963,83.37c11.943-31.89,35.718-54.788,66.886-63.826 C163.921,81.685,150.146,73.928,134.524,73.928z"></path> <path d="M43.987,148.617c1.786,5.731,4.1,11.229,6.849,16.438L36.44,179.459c-3.866,3.866-3.866,10.141,0,14.015l25.375,25.383 c1.848,1.848,4.38,2.888,7.019,2.888c2.61,0,5.125-1.04,7.005-2.888l14.38-14.404c2.158,1.142,4.55,1.842,6.785,2.827 c0-0.164-0.016-0.334-0.016-0.498c0-11.771,1.352-22.875,3.759-33.302c-17.362-11.174-28.947-30.57-28.947-52.715 c0-34.592,28.139-62.739,62.723-62.739c23.418,0,43.637,13.037,54.43,32.084c11.523-1.429,22.347-1.429,35.376,1.033 c-1.676-5.07-3.648-10.032-6.118-14.683l14.396-14.411c1.878-1.856,2.918-4.38,2.918-7.004c0-2.625-1.04-5.148-2.918-7.004 l-25.361-25.367c-1.94-1.941-4.472-2.904-7.003-2.904c-2.532,0-5.063,0.963-6.989,2.904l-14.442,14.411 c-5.217-2.764-10.699-5.078-16.444-6.825V9.9c0-5.466-4.411-9.9-9.893-9.9h-35.888c-5.451,0-9.909,4.434-9.909,9.9v20.359 c-5.73,1.747-11.213,4.061-16.446,6.825L75.839,22.689c-1.942-1.941-4.473-2.904-7.005-2.904c-2.531,0-5.077,0.963-7.003,2.896 L36.44,48.048c-1.848,1.864-2.888,4.379-2.888,7.012c0,2.632,1.04,5.148,2.888,7.004l14.396,14.403 c-2.75,5.218-5.063,10.708-6.817,16.438H23.675c-5.482,0-9.909,4.441-9.909,9.915v35.889c0,5.458,4.427,9.908,9.909,9.908H43.987z"></path> <path d="M354.871,340.654c15.872-8.705,26.773-25.367,26.773-44.703c0-28.217-22.967-51.168-51.184-51.168 c-9.923,0-19.118,2.966-26.975,7.873c-4.705,18.728-12.113,36.642-21.803,52.202C309.152,310.022,334.357,322.531,354.871,340.654z "></path> <path d="M460.782,276.588c0-5.909-4.799-10.693-10.685-10.693H428.14c-1.896-6.189-4.411-12.121-7.393-17.75l15.544-15.544 c2.02-2.004,3.137-4.721,3.137-7.555c0-2.835-1.118-5.553-3.137-7.563l-27.363-27.371c-2.08-2.09-4.829-3.138-7.561-3.138 c-2.734,0-5.467,1.048-7.547,3.138l-15.576,15.552c-5.623-2.982-11.539-5.481-17.751-7.369v-21.958 c0-5.901-4.768-10.685-10.669-10.685H311.11c-2.594,0-4.877,1.04-6.739,2.578c3.26,11.895,5.046,24.793,5.046,38.552 c0,8.735-0.682,17.604-1.956,26.423c7.205-2.656,14.876-4.324,22.999-4.324c36.99,0,67.086,30.089,67.086,67.07 c0,23.637-12.345,44.353-30.872,56.303c13.48,14.784,24.195,32.324,31.168,51.976c1.148,0.396,2.344,0.684,3.54,0.684 c2.733,0,5.467-1.04,7.563-3.13l27.379-27.371c2.004-2.004,3.106-4.721,3.106-7.555s-1.102-5.551-3.106-7.563l-15.576-15.552 c2.982-5.621,5.497-11.555,7.393-17.75h21.957c2.826,0,5.575-1.118,7.563-3.138c2.004-1.996,3.138-4.72,3.138-7.555 L460.782,276.588z"></path> <path d="M376.038,413.906c-16.602-48.848-60.471-82.445-111.113-87.018c-16.958,17.958-37.954,29.351-61.731,29.351 c-23.759,0-44.771-11.392-61.713-29.351c-50.672,4.573-94.543,38.17-111.145,87.026l-9.177,27.013 c-2.625,7.773-1.368,16.338,3.416,23.007c4.783,6.671,12.486,10.631,20.685,10.631h315.853c8.215,0,15.918-3.96,20.702-10.631 c4.767-6.669,6.041-15.234,3.4-23.007L376.038,413.906z"></path> <path d="M120.842,206.782c0,60.589,36.883,125.603,82.352,125.603c45.487,0,82.368-65.014,82.368-125.603 C285.563,81.188,120.842,80.939,120.842,206.782z"></path> </g> </g></svg>
                <a href="#adminPortal">Admin Portal</a>
            </li>   
                      
        </div>
    </section>

    <section id="interface">
        <div class ="navBar">
            <div class="Profile">
                <p id="headerName" style="margin-right: 15px; color: white;">Welcome!</p>
                <img src="aggieimpact_design/images/avatar.jpg" alt="">
            </div>
        </div>
       <div class="syncButton">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#000000" style="width: 4%; margin-left: 1%; margin-right: 1%;" d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"/></svg>
            <button class="firebase_button" id="firebaseBtn" type="button" style="width:90%">Sync Data</button>
        </div>
        <div class="searchBar">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#000000" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
            <input type="search" id="searchingFor" placeholder="Patient Lookup" maxlength="20" onkeyup="filterTable()">
        </div>
            
        <div class="board">
            <table id="patientTable">
                <thead>
                    <tr>
                        <td> Choose Patient </td>
                        <td> Patient Name </td>
                        <td> Birth Date </td>
                        <td> Patient Status </td>
                    </tr>
                </thead>
                <tbody id = "patientBody"></tbody>
            </table>
        </div>

        <div class="data_collection" id="data_collection">
            <div class="col-md-12">
               <h2 id="dataCollectionH2">Data Collection</h2> 
            </div>
            
            <div class="tab">
                <button onClick="SwitchTab(event,'Manual');">Manual Entry</button>
                <button onClick="SwitchTab(event,'Bluetooth');">Bluetooth</button>
            </div>

            <div id="Manual" class="tabcontent">
                <form id="manual_entry">
                    <div class="form_entry_row">
                        <div class="form_entry_column">
                            <div class="col-md-12">
                                <h3>Right Hand Measurements</h3>
                             </div>
                             <div class="col-md-12">
                                <label>Trial 1: </label>
                                <input class="manual_entry_form" type="text" id="man_right_t1">
                             </div>
                             <div class="col-md-12">
                                <label>Trial 2: </label>
                                <input class="manual_entry_form" type="text" id="man_right_t2">
                             </div>
                             <div class="col-md-12">
                                <label>Trial 3: </label>
                                <input class="manual_entry_form" type="text" id="man_right_t3">
                             </div>
                        </div>
                        <div class="form_entry_column">
                            <div class="col-md-12">
                                <h3>Left Hand Measurements</h3>
                             </div>
                             <div class="col-md-12">
                                <label>Trial 1: </label>
                                <input class="manual_entry_form" type="text" id="man_left_t1">
                             </div>
                             <div class="col-md-12">
                                <label>Trial 2: </label>
                                <input class="manual_entry_form" type="text" id="man_left_t2">
                             </div>
                             <div class="col-md-12">
                                <label>Trial 3: </label>
                                <input class="manual_entry_form" type="text" id="man_left_t3">
                             </div>
                        </div>
                    </div>
                    <input class="manual_entry_form" type="submit" value="Submit">
                </form>
            </div>
            <div id="Bluetooth" class="tabcontent">
                <div id="ble_collection" class="ble_collection">
                    <h3 id="ble_supported">check BLE</h3>
                    <div class="col-md-12">
                        <img src="./aggieimpact_design/images/bluetooth.png" alt="#" id="ble_status" 
                        style="height: 45px; width: 45px; padding: 5px; border-radius: 10px; background-color: #ffe26a;"></img>
                        <button id="ble_connect"> Connect Device </button>
                        <button id="ble_disconnect" onclick="DisconnectDevice()"> Disconnect </button>
                    </div>
                    <div class="form_entry_row">
                        <div class="form_entry_column">
                            <div class="col-md-12">
                                <h3>Right Hand Measurements</h3>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_right_t1" onclick="currentSample(0); CollectData();"> Trial 1</button>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_right_t2" onclick="currentSample(1); CollectData();"> Trial 2</button>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_right_t3" onclick="currentSample(2); CollectData();"> Trial 3</button>
                             </div>
                        </div>
                        <div class="form_entry_column">
                            <div class="col-md-12">
                                <h3>Left Hand Measurements</h3>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_left_t1" onclick="currentSample(3); CollectData();"> Trial 1</button>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_left_t2" onclick="currentSample(4); CollectData();"> Trial 2</button>
                             </div>
                             <div class="col-md-12">
                                <button class="trial_button" id ="ble_left_t3" onclick="currentSample(5); CollectData();"> Trial 3</button>
                             </div>
                        </div>
                        <div class="form_entry_column">
                            <div class="col-md-12">
                                <button class="trial_button" id ="ble_submit" style="width:100%"> Submit</button>
                             </div>
                        </div>
                    </div>
                    <div class="graph_entry_row">
                        <div class="graph_entry_column" style="width:25%;">
                            <div class="col-md-12">
                                <table class="opt_table" id="opt_table" width="100%">
                                    <thead>
                                        <tr>
                                            <td> Time </td>
                                            <td> Force </td>
                                        </tr>
                                    </thead>
                                    <tbody id="opt_sample_table"></tbody>
                                </table>
                                <div class="col-md-12">
                                    <button class="accept_button" id ="accept_button" onclick="Accept()"> <img src="./aggieimpact_design/images/check.png" alt="#" id="ble_status" 
                                        style="height: 45px; width: 45px; padding: 5px; border-radius: 10px; background-color: #abd699;"></img></button>
                                    <button class="reject_button" id ="reject_button" onclick="Reject()"> <img src="./aggieimpact_design/images/cross.png" alt="#" id="ble_status" 
                                        style="height: 45px; width: 45px; padding: 5px; border-radius: 10px; background-color: #ea8a81;"></img></button>
                                 </div>
                             </div>
                        </div>
                        <div class="graph_entry_column" style="width:75%;">
                            <canvas id="chart_sample" style="width:100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminExport" style="display:none;">
            <h2 id="adminExportH2">Export Data</h2>
            <button>Get CSV</button>
        </div>

        <div id="adminPortal" style="display:none;">
            <h2>Export All Patient Data</h2>
            <button id="allDataCSV">Create CSV</button>

            <h2>Register New Clinicians</h2>
            <form id="signUpForm">
                <h3>Create Account</h3>
                <ul>
                    <li>
                        <label for="name"><b>First Name</b></label>
                        <input class="inputSU" type="text" placeholder="Enter First Name" id="nameSignUp" required>
                    </li>
                    <li>
                        <label for="email"><b>Email</b></label>
                        <input class="inputSU" type="text" placeholder="Enter Email" id="emailSignUp" required>
                    </li>
                    <li>
                        <label for="password"><b>Password</b></label>
                        <input class="inputSU" type="password" placeholder="Enter Password" id="passwordSignUp" required>
                    </li>
                    <li>
                        <label for="password"><b>Confirm Password</b></label>
                        <input class="inputSU" type="password" placeholder="Confirm Password" id="passwordConfirm" required>
                    </li>
                    <li>
                        <label for="admin">Admin User</label>
                        <div class="radioBtns">
                            <label class="radio">
                                <input type="radio" name="Admin user" value="1" id="adminBtn">
                                Yes
                            </label>
                            <label class="radio">
                                <input type="radio" name="Admin user" value="0" id="adminBtnNo">
                                No
                            </label>
                        </div>
                    </li>
                    <li class="liBtn">
                        <button class="btnSU" id="submitSignUp" type="submit">Register</button>
                    </li>
                </ul>                
            </form>
        </div>
        
    </section>

    <!--bluetooth functions-->
    <script>
        const btn_connect = document.querySelector('#ble_connect');
        const ble_status = document.querySelector('#ble_status');

        let gdxDevice = "";
        let sample_data = Array(6);
        let opt_sample_data = Array(6)
        let opt_sample_time = Array(6);
        let current_index = null;
        let right_num_samples = 0;
        let left_num_samples = 0;

        let done_sampling = false;

        const ConnectDevice = async() => {
            try {
              const bleDevice = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'GDX' }],
                optionalServices: ['d91714ef-28b9-4f91-ba16-f0d9a604f112']
              });
              gdxDevice = await godirect.createDevice(bleDevice,  {open: true, startMeasurements: false});
              ble_status.style.backgroundColor = "#abd699";
              graph_interval = setInterval(updateValue, 100);
              disable_button('ble_connect');
              enable_button('ble_disconnect');
              lock_method_selection();
            } catch (err) {
                console.error(err);
            }
        }

        function CollectData() {
            // set up sensor
            const sensor = gdxDevice.getSensor(1);
            if (sensor) {
              sensor.setEnabled(true);
            }

            // clear data arrays
            done_sampling = false;
            sensor.values = [];
            sample_data[current_index] = [];
            opt_sample_data[current_index] = [];
            force_data = Array(51).fill(NaN);
            opt_data = Array(51).fill(NaN);
            
            gdxDevice.start(100);
            sensor.on('value-changed', (sensor) => {
                // samples for 5 seconds
                if (sensor.values.length > 51){
                    done_sampling = true;
                    gdxDevice.stop();
                    //clearInterval(countdown_interval);
                }
                // log the sensor name, new value and units.
                console.log(`Sensor: ${sensor.name} value: ${sensor.value} units: ${sensor.unit}`);
                // add data points to the data array
                sample_data[current_index].push(sensor.value);
            }); 
        }

        function DisconnectDevice() {
            if (gdxDevice != null) {
                gdxDevice.close();
            }
            gdxDevice = "";
            ble_status.style.backgroundColor = "#ffe26a";
            clearInterval(graph_interval);
            enable_button('ble_connect');
            disable_button('ble_disconnect');
        }

        btn_connect.addEventListener('click', ConnectDevice);

        function currentSample(index) {
            // keeps a variable with the index of the current sample
            current_index = index;
        }

    </script>

    <!--graphing functions-->
    <script>
        let graph_interval = null;
        const time = Array.from(
            { length: 51 },
            (value, index) => Math.round(index * 0.1 *10)/10);
        let force_data = [];
        let opt_data = Array(51).fill(NaN);
        let color = Array(51).fill("rgba(0,0,255,1.0)");
        let chart = new Chart.Line("chart_sample", {
        data: {
            labels: time,
            datasets: [{
                fill: false,
                lineTension: 0,
                backgroundColor: "#75c9b7",
                borderColor: "#75c9b7",
                borderWidth: 1,
                order: 1,
                data: force_data
            }, {
                fill: false,
                lineTension: 0,
                backgroundColor: "#ea8a81",
                borderColor: "#ea8a81",
                borderWidth: 1,
                order: 0,
                data: opt_data
            }]
        },
        options: {
            legend: {display: false},
            scales: {
            yAxes: [{ticks: {min: -1, max:600}}],
            },
            tooltips: {enabled: false}
        }
        });

        function updateValue() {
            force_data = sample_data[current_index];
            if (done_sampling == true) {
                opt_sample_time[current_index]= FindOptSample(force_data);
                for (let i=0;i<5;i++){
                    opt_data[opt_sample_time[current_index][i]*10] = force_data[opt_sample_time[current_index][i]*10];
                    opt_sample_data[current_index][i] = opt_data[opt_sample_time[current_index][i]*10];
                    AddToOptTable(opt_sample_time[current_index][i], opt_sample_data[current_index][i]);
                }
                // disable everything except for the accept reject buttons
                WaitForAcceptReject();
                //
                done_sampling=false;

                // do accept reject here, and increment counters
                // disable buttons in accept reject listeners
                
            }
            chart.data.datasets[0].data = force_data;
            chart.data.datasets[1].data = opt_data;
            chart.update();
        }
        
    </script>

    <!--accept/reject-->
    <script>
        function Accept() {
            AcceptTrial(current_index);
        }

        function Reject() {
            ClearOptTable();
            sample_data[current_index] = [];
            opt_sample_data[current_index] = [];
            opt_sample_time[current_index] = [];
            opt_data = [];
            updateValue();
        }
    </script>

    <!--firebase function-->
    <script type="module">
    import {AddBLEToDatabase} from "./firebase.js";
        let dBtn = document.getElementById("ble_submit");
        dBtn.addEventListener('click', StoreData);
        function StoreData() {
            AddBLEToDatabase(sample_data, opt_sample_data, opt_sample_time);
            disable_button("ble_submit");
        }

    </script>
    
</div>
</body>

</html>
